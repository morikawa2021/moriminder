# Moriminder è©³ç´°ä»•æ§˜æ›¸ï¼ˆè¨­è¨ˆæ›¸ï¼‰

## 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±

### 1.1 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¦‚è¦
æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Moriminderï¼ˆãƒ¢ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼‰ã®è¦æ±‚ä»•æ§˜æ›¸ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚ŒãŸè©³ç´°ä»•æ§˜æ›¸ï¼ˆè¨­è¨ˆæ›¸ï¼‰ã§ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®æŠ€è¡“çš„ãªè¨­è¨ˆã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€å®Ÿè£…è©³ç´°ã‚’å®šç¾©ã—ã¾ã™ã€‚

### 1.2 ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | å¤‰æ›´è€… |
|-----------|------|---------|--------|
| 1.0 | 2025-11-09 02:23 | åˆç‰ˆä½œæˆ | - |

### 1.3 é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- è¦æ±‚ä»•æ§˜æ›¸.md

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

#### 2.1.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒ‘ã‚¿ãƒ¼ãƒ³**: MVVMï¼ˆModel-View-ViewModelï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ç†ç”±**: SwiftUIã¨ã®è¦ªå’Œæ€§ãŒé«˜ãã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨ä¿å®ˆæ€§ã‚’ç¢ºä¿

#### 2.1.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer          â”‚
â”‚  (Views, ViewModels, ViewModifiers) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Business Logic Layer       â”‚
â”‚  (UseCases, Services, Managers)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Data Layer                 â”‚
â”‚  (Repositories, DataSources)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Persistence Layer          â”‚
â”‚  (Core Data / SwiftData)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 2.2.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§
1. **TaskManager**: ã‚¿ã‚¹ã‚¯ã®CRUDæ“ä½œã‚’ç®¡ç†
2. **NotificationManager**: é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¨ç®¡ç†
3. **ReminderService**: ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ
4. **AlarmService**: ã‚¢ãƒ©ãƒ¼ãƒ ã®ç®¡ç†
5. **CategoryManager**: ã‚«ãƒ†ã‚´ãƒªã®ç®¡ç†
6. **TaskSubdivisionService**: ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–æ©Ÿèƒ½ï¼ˆLLM APIé€£æºï¼‰
7. **NaturalLanguageParser**: è‡ªç„¶è¨€èªã‹ã‚‰ã®æ—¥æ™‚æŠ½å‡º
8. **RepeatingTaskGenerator**: ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã®ç”Ÿæˆ

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

### 3.1 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¨­è¨ˆ

#### 3.1.1 Taskï¼ˆã‚¿ã‚¹ã‚¯ï¼‰
```swift
class Task: NSManagedObject {
    // åŸºæœ¬æƒ…å ±
    @NSManaged var id: UUID
    @NSManaged var title: String              // ã‚¿ã‚¹ã‚¯åï¼ˆå¿…é ˆï¼‰
    @NSManaged var createdAt: Date            // ç™»éŒ²æ—¥æ™‚
    @NSManaged var completedAt: Date?         // å®Œäº†æ—¥æ™‚
    
    // åˆ†é¡
    @NSManaged var category: Category?        // ã‚«ãƒ†ã‚´ãƒªï¼ˆä»»æ„ï¼‰
    @NSManaged var priority: Priority         // é‡è¦åº¦ï¼ˆä½/ä¸­/é«˜ï¼‰
    
    // æ—¥æ™‚è¨­å®š
    @NSManaged var taskType: TaskType         // ã‚¿ã‚¹ã‚¯/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    @NSManaged var deadline: Date?            // æœŸé™ï¼ˆã‚¿ã‚¹ã‚¯ã®å ´åˆï¼‰
    @NSManaged var startDateTime: Date?       // é–‹å§‹æ—¥æ™‚ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å ´åˆï¼‰
    
    // é€šçŸ¥è¨­å®š
    @NSManaged var alarmDateTime: Date?       // ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»
    @NSManaged var alarmSound: String?        // ã‚¢ãƒ©ãƒ¼ãƒ éŸ³
    @NSManaged var alarmEnabled: Bool         // ã‚¢ãƒ©ãƒ¼ãƒ æœ‰åŠ¹/ç„¡åŠ¹
    
    // ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š
    @NSManaged var reminderEnabled: Bool      // ãƒªãƒã‚¤ãƒ³ãƒ‰æœ‰åŠ¹/ç„¡åŠ¹
    @NSManaged var reminderInterval: Int      // ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ï¼ˆåˆ†ï¼‰
    @NSManaged var reminderStartTime: Date?   // ãƒªãƒã‚¤ãƒ³ãƒ‰é–‹å§‹æ™‚åˆ»
    @NSManaged var reminderEndTime: Date?     // ãƒªãƒã‚¤ãƒ³ãƒ‰çµ‚äº†æ™‚åˆ»
    @NSManaged var snoozeMaxCount: Int        // ã‚¹ãƒŒãƒ¼ã‚ºæœ€å¤§å›æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ã€æœ€å¤§10ï¼‰
    @NSManaged var snoozeUnlimited: Bool      // ç„¡æœŸé™ã‚¹ãƒŒãƒ¼ã‚ºï¼ˆæœŸé™è¶…éæ™‚ï¼‰
    @NSManaged var snoozeCount: Int           // ç¾åœ¨ã®ã‚¹ãƒŒãƒ¼ã‚ºå›æ•°
    
    // ç¹°ã‚Šè¿”ã—è¨­å®š
    @NSManaged var isRepeating: Bool          // ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã‹ã©ã†ã‹
    @NSManaged var repeatPattern: RepeatPattern? // ç¹°ã‚Šè¿”ã—ãƒ‘ã‚¿ãƒ¼ãƒ³
    @NSManaged var repeatEndDate: Date?       // ç¹°ã‚Šè¿”ã—çµ‚äº†æ—¥æ™‚
    @NSManaged var parentTaskId: UUID?         // è¦ªã‚¿ã‚¹ã‚¯IDï¼ˆç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã®å ´åˆï¼‰
    
    // çŠ¶æ…‹
    @NSManaged var isCompleted: Bool           // å®Œäº†çŠ¶æ…‹
    @NSManaged var isArchived: Bool           // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–çŠ¶æ…‹
}
```

#### 3.1.2 Categoryï¼ˆã‚«ãƒ†ã‚´ãƒªï¼‰
```swift
class Category: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String               // ã‚«ãƒ†ã‚´ãƒªå
    @NSManaged var color: String              // ã‚«ãƒ†ã‚´ãƒªã®è‰²ï¼ˆHEXã‚³ãƒ¼ãƒ‰ï¼‰
    @NSManaged var createdAt: Date
    @NSManaged var usageCount: Int            // ä½¿ç”¨å›æ•°ï¼ˆã‚ˆãä½¿ã†ã‚«ãƒ†ã‚´ãƒªã®åˆ¤å®šç”¨ï¼‰
    @NSManaged var tasks: NSSet?              // é–¢é€£ã‚¿ã‚¹ã‚¯
}
```

#### 3.1.3 NotificationRecordï¼ˆé€šçŸ¥è¨˜éŒ²ï¼‰
```swift
class NotificationRecord: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var taskId: UUID               // é–¢é€£ã‚¿ã‚¹ã‚¯ID
    @NSManaged var notificationId: String     // ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥ID
    @NSManaged var scheduledTime: Date        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚åˆ»
    @NSManaged var notificationType: NotificationType // ã‚¢ãƒ©ãƒ¼ãƒ /ãƒªãƒã‚¤ãƒ³ãƒ‰
    @NSManaged var isDelivered: Bool          // é…ä¿¡æ¸ˆã¿ã‹ã©ã†ã‹
    @NSManaged var deliveredAt: Date?         // é…ä¿¡æ—¥æ™‚
}
```

#### 3.1.4 PresetTimeï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“ï¼‰
```swift
class PresetTime: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String               // ãƒ—ãƒªã‚»ãƒƒãƒˆåï¼ˆä¾‹: "ä»Šæ—¥ã®9æ™‚"ï¼‰
    @NSManaged var hour: Int                  // æ™‚
    @NSManaged var minute: Int                // åˆ†
    @NSManaged var offsetDays: Int            // æ—¥ä»˜ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆ0=ä»Šæ—¥ã€1=æ˜æ—¥ãªã©ï¼‰
    @NSManaged var isDefault: Bool            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã©ã†ã‹
    @NSManaged var order: Int                 // è¡¨ç¤ºé †åº
}
```

### 3.2 åˆ—æŒ™å‹å®šç¾©

#### 3.2.1 TaskType
```swift
enum TaskType: String, Codable {
    case task = "task"           // ã‚¿ã‚¹ã‚¯ï¼ˆæœŸé™è¨­å®šï¼‰
    case schedule = "schedule"   // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆé–‹å§‹æ—¥æ™‚è¨­å®šï¼‰
}
```

#### 3.2.2 Priority
```swift
enum Priority: String, Codable {
    case low = "low"     // ä½
    case medium = "medium" // ä¸­
    case high = "high"   // é«˜
}
```

#### 3.2.3 RepeatPattern
```swift
enum RepeatPattern: String, Codable {
    case daily = "daily"                     // æ¯æ—¥
    case weekly = "weekly"                   // æ¯é€±
    case monthly = "monthly"                 // æ¯æœˆ
    case yearly = "yearly"                   // æ¯å¹´
    case custom = "custom"                   // ã‚«ã‚¹ã‚¿ãƒ 
    case nthWeekdayOfMonth = "nthWeekdayOfMonth" // æ¯æœˆç¬¬Næ›œæ—¥
    case everyNDays = "everyNDays"           // Næ—¥ã”ã¨
}
```

#### 3.2.4 NotificationType
```swift
enum NotificationType: String, Codable {
    case alarm = "alarm"         // ã‚¢ãƒ©ãƒ¼ãƒ 
    case reminder = "reminder"    // ãƒªãƒã‚¤ãƒ³ãƒ‰
}
```

### 3.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

#### 3.3.1 Core Data ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```
Task
â”œâ”€â”€ category (Category) [Optional, To-One]
â”œâ”€â”€ repeatPattern (RepeatPattern) [Optional]
â””â”€â”€ notifications (NotificationRecord) [To-Many]

Category
â””â”€â”€ tasks (Task) [To-Many]

NotificationRecord
â””â”€â”€ task (Task) [To-One]
```

---

## 4. ç”»é¢è¨­è¨ˆ

### 4.1 ç”»é¢ä¸€è¦§

| ç”»é¢ID | ç”»é¢å | èª¬æ˜ |
|--------|--------|------|
| S001 | ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ | ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’ä¸€è¦§è¡¨ç¤º |
| S002 | ã‚¿ã‚¹ã‚¯ç™»éŒ²ç”»é¢ | æ–°è¦ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ² |
| S003 | ã‚¿ã‚¹ã‚¯ç·¨é›†ç”»é¢ | æ—¢å­˜ã‚¿ã‚¹ã‚¯ã‚’ç·¨é›† |
| S004 | ã‚¿ã‚¹ã‚¯è©³ç´°ç”»é¢ | ã‚¿ã‚¹ã‚¯ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º |
| S005 | ç´°åˆ†åŒ–ææ¡ˆç”»é¢ | LLMã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–ææ¡ˆã‚’è¡¨ç¤º |
| S006 | ã‚«ãƒ†ã‚´ãƒªç®¡ç†ç”»é¢ | ã‚«ãƒ†ã‚´ãƒªã®ä¸€è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ |
| S007 | è¨­å®šç”»é¢ | ã‚¢ãƒ—ãƒªè¨­å®š |

### 4.2 ç”»é¢è©³ç´°è¨­è¨ˆ

#### 4.2.1 S001: ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢

**ç”»é¢æ§‹æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ãƒ•ã‚£ãƒ«ã‚¿] [ã‚½ãƒ¼ãƒˆ] [æ¤œç´¢]         â”‚ â† ãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ ã‚¿ã‚¹ã‚¯å                  â”‚   â”‚
â”‚  â”‚ ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª  â­ é‡è¦åº¦      â”‚   â”‚
â”‚  â”‚ ğŸ“… æœŸé™: 2025/01/15 15:00   â”‚   â”‚
â”‚  â”‚ ğŸ”” ãƒªãƒã‚¤ãƒ³ãƒ‰: 1æ™‚é–“é–“éš”     â”‚   â”‚
â”‚  â”‚ [ã‚¹ãƒ¯ã‚¤ãƒ—: å®Œäº†/å‰Šé™¤]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ åˆ¥ã®ã‚¿ã‚¹ã‚¯                â”‚   â”‚
â”‚  â”‚ ...                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        [+ æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ ]           â”‚ â† å›ºå®šãƒœã‚¿ãƒ³
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Viewæ§‹é€ **
```swift
struct TaskListView: View {
    @StateObject private var viewModel: TaskListViewModel
    @State private var filterMode: FilterMode = .all
    @State private var sortMode: SortMode = .createdAtDesc
    
    var body: some View {
        NavigationView {
            VStack {
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ã‚½ãƒ¼ãƒˆãƒãƒ¼
                FilterSortBar(...)
                
                // ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ
                List {
                    ForEach(viewModel.tasks) { task in
                        TaskCardView(task: task)
                            .swipeActions(edge: .trailing) {
                                // å®Œäº†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                                Button {
                                    viewModel.completeTask(task)
                                } label: {
                                    Label("å®Œäº†", systemImage: "checkmark")
                                }
                                .tint(.green)
                                
                                // å‰Šé™¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                                Button(role: .destructive) {
                                    viewModel.deleteTask(task)
                                } label: {
                                    Label("å‰Šé™¤", systemImage: "trash")
                                }
                            }
                    }
                }
                
                // æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒœã‚¿ãƒ³
                Button {
                    viewModel.showAddTask = true
                } label: {
                    Label("æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ ", systemImage: "plus.circle.fill")
                        .font(.title2)
                }
                .padding()
            }
            .navigationTitle("ã‚¿ã‚¹ã‚¯ä¸€è¦§")
            .sheet(isPresented: $viewModel.showAddTask) {
                TaskEditView(mode: .create)
            }
        }
    }
}
```

**ViewModel**
```swift
class TaskListViewModel: ObservableObject {
    @Published var tasks: [Task] = []
    @Published var filterMode: FilterMode = .all
    @Published var sortMode: SortMode = .createdAtDesc
    @Published var showAddTask = false
    
    private let taskManager: TaskManager
    
    func loadTasks() {
        tasks = taskManager.fetchTasks(
            filter: filterMode,
            sort: sortMode
        )
    }
    
    func completeTask(_ task: Task) {
        // ãƒªãƒã‚¤ãƒ³ãƒ‰ä¸­ã®ã‚¿ã‚¹ã‚¯ã®å ´åˆã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
        if task.reminderEnabled {
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
        } else {
            taskManager.completeTask(task)
        }
    }
    
    func deleteTask(_ task: Task) {
        taskManager.deleteTask(task)
        loadTasks()
    }
}
```

#### 4.2.2 S002/S003: ã‚¿ã‚¹ã‚¯ç™»éŒ²ãƒ»ç·¨é›†ç”»é¢

**ç”»é¢æ§‹æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]  ã‚¿ã‚¹ã‚¯ç™»éŒ²  [ä¿å­˜]   â”‚ â† ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ã‚¿ã‚¹ã‚¯å *                  â”‚   â”‚
â”‚  â”‚ [________________________]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒª                    â”‚   â”‚
â”‚  â”‚ [ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆå…¥åŠ›]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é‡è¦åº¦                      â”‚   â”‚
â”‚  â”‚ [ä½] [ä¸­] [é«˜]              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â–¼ æ—¥æ™‚è¨­å®š                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [æœŸé™] [é–‹å§‹æ—¥æ™‚]            â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“:              â”‚   â”‚
â”‚  â”‚ [ä»Šæ—¥9æ™‚] [ä»Šæ—¥12æ™‚] ...    â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚ [ã‚«ã‚¹ã‚¿ãƒ æ™‚é–“ã‚’è¨­å®š]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â–¼ ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®š                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ON/OFF]                    â”‚   â”‚
â”‚  â”‚ ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»: [è¨­å®š]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â–¼ ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ON/OFF]                    â”‚   â”‚
â”‚  â”‚ é–“éš”: [1æ™‚é–“]               â”‚   â”‚
â”‚  â”‚ ã‚¹ãƒŒãƒ¼ã‚ºæœ€å¤§å›æ•°: [5å›]     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â–¼ ç¹°ã‚Šè¿”ã—è¨­å®š                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ON/OFF]                    â”‚   â”‚
â”‚  â”‚ ãƒ‘ã‚¿ãƒ¼ãƒ³: [æ¯æ—¥] [æ¯é€±] ... â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Viewæ§‹é€ **
```swift
struct TaskEditView: View {
    enum Mode {
        case create
        case edit(Task)
    }
    
    let mode: Mode
    @StateObject private var viewModel: TaskEditViewModel
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationView {
            Form {
                // ã‚¿ã‚¹ã‚¯å
                Section {
                    TextField("ã‚¿ã‚¹ã‚¯å", text: $viewModel.title)
                        .font(.title3)
                }
                
                // ã‚«ãƒ†ã‚´ãƒª
                Section("ã‚«ãƒ†ã‚´ãƒª") {
                    CategoryPickerView(
                        selectedCategory: $viewModel.category,
                        categories: viewModel.categories
                    )
                }
                
                // é‡è¦åº¦
                Section("é‡è¦åº¦") {
                    Picker("é‡è¦åº¦", selection: $viewModel.priority) {
                        Text("ä½").tag(Priority.low)
                        Text("ä¸­").tag(Priority.medium)
                        Text("é«˜").tag(Priority.high)
                    }
                    .pickerStyle(.segmented)
                }
                
                // æ—¥æ™‚è¨­å®š
                Section {
                    DateSettingView(
                        taskType: $viewModel.taskType,
                        deadline: $viewModel.deadline,
                        startDateTime: $viewModel.startDateTime,
                        presetTimes: viewModel.presetTimes
                    )
                }
                
                // ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®š
                Section {
                    AlarmSettingView(
                        enabled: $viewModel.alarmEnabled,
                        dateTime: $viewModel.alarmDateTime,
                        sound: $viewModel.alarmSound
                    )
                }
                
                // ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š
                Section {
                    ReminderSettingView(
                        enabled: $viewModel.reminderEnabled,
                        interval: $viewModel.reminderInterval,
                        priority: viewModel.priority,
                        taskType: viewModel.taskType,
                        snoozeMaxCount: $viewModel.snoozeMaxCount
                    )
                }
                
                // ç¹°ã‚Šè¿”ã—è¨­å®š
                Section {
                    RepeatSettingView(
                        enabled: $viewModel.isRepeating,
                        pattern: $viewModel.repeatPattern,
                        endDate: $viewModel.repeatEndDate
                    )
                }
            }
            .navigationTitle(mode == .create ? "ã‚¿ã‚¹ã‚¯ç™»éŒ²" : "ã‚¿ã‚¹ã‚¯ç·¨é›†")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("ã‚­ãƒ£ãƒ³ã‚»ãƒ«") {
                        dismiss()
                    }
                }
                ToolbarItem(placement: .confirmationAction) {
                    Button("ä¿å­˜") {
                        viewModel.save()
                        dismiss()
                    }
                    .disabled(!viewModel.isValid)
                }
            }
        }
    }
}
```

**è‡ªç„¶è¨€èªè§£æã®çµ±åˆ**
```swift
struct TaskNameInputView: View {
    @Binding var title: String
    @Binding var extractedDateTime: Date?
    @Binding var extractedTaskType: TaskType?
    
    @StateObject private var parser = NaturalLanguageParser()
    
    var body: some View {
        TextField("ã‚¿ã‚¹ã‚¯å", text: $title)
            .onChange(of: title) { newValue in
                parseNaturalLanguage(newValue)
            }
    }
    
    private func parseNaturalLanguage(_ text: String) {
        let result = parser.extractDateTime(from: text)
        if let dateTime = result.dateTime {
            extractedDateTime = dateTime
            extractedTaskType = result.taskType
            // æŠ½å‡ºçµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
        }
    }
}
```

#### 4.2.3 S005: ç´°åˆ†åŒ–ææ¡ˆç”»é¢

**ç”»é¢æ§‹æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é–‰ã˜ã‚‹]  ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  å…ƒã®ã‚¿ã‚¹ã‚¯:                        â”‚
â”‚  ã€Œéƒ¨å±‹ã®æƒé™¤ã€                     â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [å‡¦ç†ä¸­...]                 â”‚   â”‚ â† LLMå‡¦ç†ä¸­
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  ææ¡ˆã•ã‚ŒãŸç´°åˆ†åŒ–ã‚¿ã‚¹ã‚¯:             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜‘ åºŠã‚’æƒé™¤æ©Ÿã§ã‹ã‘ã‚‹        â”‚   â”‚
â”‚  â”‚ â˜‘ çª“ã‚’æ‹­ã                  â”‚   â”‚
â”‚  â”‚ â˜‘ ã‚´ãƒŸã‚’æ¨ã¦ã‚‹              â”‚   â”‚
â”‚  â”‚ â˜ æœºã‚’æ•´ç†ã™ã‚‹              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  [æ‰¿èª] [ä¿®æ­£] [å´ä¸‹]               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Viewæ§‹é€ **
```swift
struct TaskSubdivisionView: View {
    let originalTask: Task
    @StateObject private var viewModel: TaskSubdivisionViewModel
    @Environment(\.dismiss) private var dismiss
    
    var body: some View {
        NavigationView {
            VStack {
                // å…ƒã®ã‚¿ã‚¹ã‚¯è¡¨ç¤º
                Text("å…ƒã®ã‚¿ã‚¹ã‚¯:")
                    .font(.headline)
                Text(originalTask.title)
                    .font(.title2)
                    .padding()
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¾ãŸã¯ææ¡ˆãƒªã‚¹ãƒˆ
                if viewModel.isLoading {
                    ProgressView("å‡¦ç†ä¸­...")
                        .padding()
                } else if let proposals = viewModel.proposals {
                    List {
                        ForEach(proposals) { proposal in
                            HStack {
                                Toggle("", isOn: Binding(
                                    get: { proposal.isSelected },
                                    set: { viewModel.toggleProposal(proposal, isSelected: $0) }
                                ))
                                Text(proposal.title)
                            }
                        }
                    }
                } else if let error = viewModel.error {
                    VStack {
                        Text("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
                            .foregroundColor(.red)
                        Text(error.localizedDescription)
                        Button("å†è©¦è¡Œ") {
                            viewModel.generateProposals()
                        }
                    }
                }
                
                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
                HStack {
                    Button("å´ä¸‹") {
                        dismiss()
                    }
                    .buttonStyle(.bordered)
                    
                    Button("ä¿®æ­£") {
                        viewModel.showEditMode = true
                    }
                    .buttonStyle(.bordered)
                    
                    Button("æ‰¿èª") {
                        viewModel.approveProposals()
                        dismiss()
                    }
                    .buttonStyle(.borderedProminent)
                    .disabled(viewModel.proposals?.isEmpty ?? true)
                }
                .padding()
            }
            .navigationTitle("ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–")
            .navigationBarTitleDisplayMode(.inline)
            .toolbar {
                ToolbarItem(placement: .cancellationAction) {
                    Button("é–‰ã˜ã‚‹") {
                        dismiss()
                    }
                }
            }
            .onAppear {
                viewModel.generateProposals(for: originalTask)
            }
        }
    }
}
```

---

## 5. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆ

### 5.1 ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯

#### 5.1.1 TaskManager

```swift
class TaskManager {
    private let repository: TaskRepository
    private let notificationManager: NotificationManager
    
    // ã‚¿ã‚¹ã‚¯ä½œæˆ
    func createTask(_ task: Task) async throws {
        // 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        try validateTask(task)
        
        // 2. ä¿å­˜
        try await repository.save(task)
        
        // 3. é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        if task.alarmEnabled {
            try await notificationManager.scheduleAlarm(for: task)
        }
        if task.reminderEnabled {
            try await notificationManager.scheduleReminder(for: task)
        }
        
        // 4. ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã®å ´åˆã¯æ¬¡å›ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
        if task.isRepeating {
            try await generateNextRepeatInstance(for: task)
        }
    }
    
    // ã‚¿ã‚¹ã‚¯å®Œäº†
    func completeTask(_ task: Task) async throws {
        // 1. å®Œäº†ç¢ºèªï¼ˆãƒªãƒã‚¤ãƒ³ãƒ‰ä¸­ã®å ´åˆã¯ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå¿…è¦ï¼‰
        if task.reminderEnabled && !task.isCompleted {
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯UIå±¤ã§å‡¦ç†
        }
        
        // 2. ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†çŠ¶æ…‹ã«æ›´æ–°
        task.isCompleted = true
        task.completedAt = Date()
        
        // 3. é€šçŸ¥ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        try await notificationManager.cancelNotifications(for: task)
        
        // 4. ä¿å­˜
        try await repository.save(task)
        
        // 5. ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã®å ´åˆã¯æ¬¡å›ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
        if task.isRepeating {
            try await generateNextRepeatInstance(for: task)
        }
    }
    
    // ã‚¿ã‚¹ã‚¯å‰Šé™¤
    func deleteTask(_ task: Task) async throws {
        // 1. é€šçŸ¥ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        try await notificationManager.cancelNotifications(for: task)
        
        // 2. å‰Šé™¤
        try await repository.delete(task)
    }
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    private func validateTask(_ task: Task) throws {
        guard !task.title.isEmpty else {
            throw TaskError.invalidTitle
        }
        
        // æ—¥æ™‚è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if let deadline = task.deadline, let startDateTime = task.startDateTime {
            guard deadline >= startDateTime else {
                throw TaskError.invalidDateTime
            }
        }
    }
}
```

### 5.2 ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯

#### 5.2.1 ReminderService

```swift
class ReminderService {
    private let notificationManager: NotificationManager
    
    // ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    func scheduleReminder(for task: Task) async throws {
        guard task.reminderEnabled else { return }
        
        let intervals = calculateReminderIntervals(for: task)
        let startTime = task.reminderStartTime ?? Date()
        let endTime = task.reminderEndTime ?? task.deadline ?? task.startDateTime
        
        var currentTime = startTime
        var notificationCount = 0
        
        while currentTime <= (endTime ?? Date().addingTimeInterval(86400 * 365)) {
            // ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ãªã„å ´åˆã®ã¿é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
            if !task.isCompleted {
                let interval = intervals[notificationCount % intervals.count]
                currentTime = currentTime.addingTimeInterval(TimeInterval(interval * 60))
                
                if let endTime = endTime, currentTime > endTime {
                    break
                }
                
                try await notificationManager.scheduleReminderNotification(
                    for: task,
                    at: currentTime
                )
            }
            
            notificationCount += 1
        }
    }
    
    // ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ã®è¨ˆç®—ï¼ˆé‡è¦åº¦ã¨ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã«åŸºã¥ãï¼‰
    private func calculateReminderIntervals(for task: Task) -> [Int] {
        let priority = task.priority
        let taskType = task.taskType
        
        switch (priority, taskType) {
        case (.low, .task):
            // ä½é‡è¦åº¦ãƒ»ã‚¿ã‚¹ã‚¯: 24æ™‚é–“é–“éš”
            return [1440] // 24æ™‚é–“ = 1440åˆ†
            
        case (.medium, .task):
            // ä¸­é‡è¦åº¦ãƒ»ã‚¿ã‚¹ã‚¯: 3æ™‚é–“é–“éš”
            return [180] // 3æ™‚é–“ = 180åˆ†
            
        case (.high, .task):
            // é«˜é‡è¦åº¦ãƒ»ã‚¿ã‚¹ã‚¯: 1æ™‚é–“é–“éš”
            return [60] // 1æ™‚é–“ = 60åˆ†
            
        case (.low, .schedule):
            // ä½é‡è¦åº¦ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: æ®µéšçš„ãƒªãƒã‚¤ãƒ³ãƒ‰
            return calculateStagedIntervals(
                startDateTime: task.startDateTime!,
                stages: [
                    (days: 3, interval: 1440),    // 3æ—¥å‰ã‹ã‚‰: 1æ—¥1å›
                    (days: 1, interval: 720),      // 1æ—¥å‰ã‹ã‚‰: 12æ™‚é–“é–“éš”
                    (hours: 6, interval: 360),      // 6æ™‚é–“å‰ã‹ã‚‰: 6æ™‚é–“é–“éš”
                    (hours: 1, interval: 60),      // 1æ™‚é–“å‰ã‹ã‚‰: 1æ™‚é–“é–“éš”
                ],
                overdueInterval: 30                 // é–‹å§‹æ—¥æ™‚è¶…éå¾Œ: 30åˆ†é–“éš”
            )
            
        case (.medium, .schedule):
            // ä¸­é‡è¦åº¦ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: æ®µéšçš„ãƒªãƒã‚¤ãƒ³ãƒ‰
            return calculateStagedIntervals(
                startDateTime: task.startDateTime!,
                stages: [
                    (days: 7, interval: 1440),     // 1é€±é–“å‰ã‹ã‚‰: 1æ—¥1å›
                    (days: 3, interval: 720),       // 3æ—¥å‰ã‹ã‚‰: 12æ™‚é–“é–“éš”
                    (days: 1, interval: 360),       // 1æ—¥å‰ã‹ã‚‰: 6æ™‚é–“é–“éš”
                    (hours: 6, interval: 180),      // 6æ™‚é–“å‰ã‹ã‚‰: 3æ™‚é–“é–“éš”
                    (hours: 3, interval: 60),       // 3æ™‚é–“å‰ã‹ã‚‰: 1æ™‚é–“é–“éš”
                    (hours: 1, interval: 30),       // 1æ™‚é–“å‰ã‹ã‚‰: 30åˆ†é–“éš”
                ],
                overdueInterval: 15                 // é–‹å§‹æ—¥æ™‚è¶…éå¾Œ: 15åˆ†é–“éš”
            )
            
        case (.high, .schedule):
            // é«˜é‡è¦åº¦ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: æ®µéšçš„ãƒªãƒã‚¤ãƒ³ãƒ‰
            return calculateStagedIntervals(
                startDateTime: task.startDateTime!,
                stages: [
                    (days: 7, interval: 1440),     // 1é€±é–“å‰ã‹ã‚‰: 1æ—¥1å›
                    (days: 3, interval: 720),       // 3æ—¥å‰ã‹ã‚‰: 12æ™‚é–“é–“éš”
                    (days: 1, interval: 360),       // 1æ—¥å‰ã‹ã‚‰: 6æ™‚é–“é–“éš”
                    (hours: 6, interval: 180),      // 6æ™‚é–“å‰ã‹ã‚‰: 3æ™‚é–“é–“éš”
                    (hours: 3, interval: 60),       // 3æ™‚é–“å‰ã‹ã‚‰: 1æ™‚é–“é–“éš”
                    (hours: 1, interval: 30),       // 1æ™‚é–“å‰ã‹ã‚‰: 30åˆ†é–“éš”
                    (hours: 0.5, interval: 15),     // 30åˆ†å‰ã‹ã‚‰: 15åˆ†é–“éš”
                    (hours: 0.25, interval: 5),    // 15åˆ†å‰ã‹ã‚‰: 5åˆ†é–“éš”
                    (hours: 0.083, interval: 1),    // 5åˆ†å‰ã‹ã‚‰: 1åˆ†é–“éš”
                ],
                overdueInterval: 1                  // é–‹å§‹æ—¥æ™‚è¶…éå¾Œ: 1åˆ†é–“éš”
            )
        }
    }
    
    // æ®µéšçš„ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ã®è¨ˆç®—
    private func calculateStagedIntervals(
        startDateTime: Date,
        stages: [(days: Double?, hours: Double?, interval: Int)],
        overdueInterval: Int
    ) -> [Int] {
        let now = Date()
        let timeUntilStart = startDateTime.timeIntervalSince(now)
        
        var intervals: [Int] = []
        
        // å„ã‚¹ãƒ†ãƒ¼ã‚¸ã®é–“éš”ã‚’è¨ˆç®—
        for stage in stages {
            let threshold: TimeInterval
            if let days = stage.days {
                threshold = days * 86400
            } else if let hours = stage.hours {
                threshold = hours * 3600
            } else {
                continue
            }
            
            if timeUntilStart > threshold {
                intervals.append(stage.interval)
            }
        }
        
        // é–‹å§‹æ—¥æ™‚ã‚’éããŸå ´åˆã®é–“éš”
        if timeUntilStart <= 0 {
            intervals.append(overdueInterval)
        }
        
        return intervals.isEmpty ? [60] : intervals
    }
}
```

### 5.3 é€šçŸ¥ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯

#### 5.3.1 NotificationManager

```swift
class NotificationManager {
    private let center = UNUserNotificationCenter.current()
    
    // é€šçŸ¥æ¨©é™ã®è¦æ±‚
    func requestAuthorization() async throws {
        let granted = try await center.requestAuthorization(options: [
            .alert, .sound, .badge, .criticalAlert
        ])
        
        guard granted else {
            throw NotificationError.authorizationDenied
        }
    }
    
    // ã‚¢ãƒ©ãƒ¼ãƒ é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    func scheduleAlarm(for task: Task) async throws {
        guard let alarmDateTime = task.alarmDateTime else { return }
        guard alarmDateTime > Date() else { return }
        
        let content = UNMutableNotificationContent()
        content.title = "ã‚¢ãƒ©ãƒ¼ãƒ : \(task.title)"
        content.body = "è¨­å®šæ™‚åˆ»ã«ãªã‚Šã¾ã—ãŸ"
        content.sound = UNNotificationSound(named: UNNotificationSoundName(task.alarmSound ?? "default"))
        content.categoryIdentifier = "ALARM"
        
        // é‡è¦åº¦è¨­å®š
        content.interruptionLevel = mapPriorityToInterruptionLevel(task.priority)
        
        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        let trigger = UNCalendarNotificationTrigger(
            dateMatching: Calendar.current.dateComponents(
                [.year, .month, .day, .hour, .minute],
                from: alarmDateTime
            ),
            repeats: false
        )
        
        let request = UNNotificationRequest(
            identifier: "alarm_\(task.id.uuidString)",
            content: content,
            trigger: trigger
        )
        
        try await center.add(request)
    }
    
    // ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    func scheduleReminderNotification(for task: Task, at date: Date) async throws {
        guard date > Date() else { return }
        
        let content = UNMutableNotificationContent()
        content.title = "ãƒªãƒã‚¤ãƒ³ãƒ‰: \(task.title)"
        if let category = task.category {
            content.body = "ã‚«ãƒ†ã‚´ãƒª: \(category.name)"
        } else {
            content.body = "ã‚¿ã‚¹ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        }
        content.sound = .default
        content.categoryIdentifier = "REMINDER"
        
        // é‡è¦åº¦è¨­å®š
        content.interruptionLevel = mapPriorityToInterruptionLevel(task.priority)
        
        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        let trigger = UNCalendarNotificationTrigger(
            dateMatching: Calendar.current.dateComponents(
                [.year, .month, .day, .hour, .minute],
                from: date
            ),
            repeats: false
        )
        
        let request = UNNotificationRequest(
            identifier: "reminder_\(task.id.uuidString)_\(date.timeIntervalSince1970)",
            content: content,
            trigger: trigger
        )
        
        try await center.add(request)
    }
    
    // é€šçŸ¥ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    func cancelNotifications(for task: Task) async {
        let identifiers = [
            "alarm_\(task.id.uuidString)",
            // ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ã®IDã¯å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§å‰Šé™¤
        ]
        
        // ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã€å…¨ã¦ã®é€šçŸ¥ã‚’å–å¾—ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        let pendingRequests = await center.pendingNotificationRequests()
        let taskNotificationIds = pendingRequests
            .filter { $0.identifier.contains(task.id.uuidString) }
            .map { $0.identifier }
        
        center.removePendingNotificationRequests(withIdentifiers: taskNotificationIds)
    }
    
    // ã‚¹ãƒŒãƒ¼ã‚ºå‡¦ç†
    func snoozeReminder(for task: Task) async throws {
        // ã‚¹ãƒŒãƒ¼ã‚ºå›æ•°ã‚’ãƒã‚§ãƒƒã‚¯
        guard task.snoozeCount < task.snoozeMaxCount || task.snoozeUnlimited else {
            throw NotificationError.maxSnoozeReached
        }
        
        // ã‚¹ãƒŒãƒ¼ã‚ºå›æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
        task.snoozeCount += 1
        
        // æ¬¡ã®ãƒªãƒã‚¤ãƒ³ãƒ‰æ™‚åˆ»ã‚’è¨ˆç®—ï¼ˆç¾åœ¨æ™‚åˆ» + ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ï¼‰
        let nextReminderTime = Date().addingTimeInterval(
            TimeInterval(task.reminderInterval * 60)
        )
        
        // æ¬¡ã®ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        try await scheduleReminderNotification(for: task, at: nextReminderTime)
    }
    
    // é‡è¦åº¦ã‚’é€šçŸ¥é‡è¦åº¦ã«ãƒãƒƒãƒ”ãƒ³ã‚°
    private func mapPriorityToInterruptionLevel(_ priority: Priority) -> UNNotificationInterruptionLevel {
        switch priority {
        case .high:
            return .critical  // å¯èƒ½ãªé™ã‚Šæœ€é«˜ã®é‡è¦åº¦
        case .medium:
            return .timeSensitive  // æ™‚é–“ã«æ•æ„Ÿãªé€šçŸ¥
        case .low:
            return .active  // æ¨™æº–ã®é‡è¦åº¦
        }
    }
}
```

### 5.4 ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–ãƒ­ã‚¸ãƒƒã‚¯

#### 5.4.1 TaskSubdivisionService

```swift
class TaskSubdivisionService {
    private let apiClient: LLMAPIClient
    private let taskManager: TaskManager
    
    // ç´°åˆ†åŒ–ææ¡ˆã®ç”Ÿæˆ
    func generateSubdivisionProposals(for task: Task) async throws -> [SubdivisionProposal] {
        // 1. LLM APIã‚’å‘¼ã³å‡ºã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ç´°åˆ†åŒ–
        let response = try await apiClient.subdivideTask(task.title)
        
        // 2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹
        let proposals = response.subtasks.map { subtaskTitle in
            SubdivisionProposal(
                title: subtaskTitle,
                isSelected: true
            )
        }
        
        return proposals
    }
    
    // ææ¡ˆã‚’æ‰¿èªã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
    func approveProposals(_ proposals: [SubdivisionProposal], parentTask: Task) async throws {
        for proposal in proposals where proposal.isSelected {
            let subtask = Task(
                title: proposal.title,
                category: parentTask.category,
                priority: parentTask.priority,
                taskType: parentTask.taskType,
                deadline: parentTask.deadline,
                startDateTime: parentTask.startDateTime,
                reminderEnabled: parentTask.reminderEnabled,
                reminderInterval: parentTask.reminderInterval
            )
            
            try await taskManager.createTask(subtask)
        }
    }
}
```

#### 5.4.2 LLMAPIClient

```swift
class LLMAPIClient {
    private let apiKey: String
    private let baseURL: URL
    private let session: URLSession
    
    struct SubdivisionResponse: Codable {
        let subtasks: [String]
    }
    
    // ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–APIå‘¼ã³å‡ºã—
    func subdivideTask(_ taskTitle: String) async throws -> SubdivisionResponse {
        // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆä¾‹: OpenAI APIï¼‰
        let url = baseURL.appendingPathComponent("/v1/chat/completions")
        
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("Bearer \(apiKey)", forHTTPHeaderField: "Authorization")
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        
        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
        let prompt = """
        ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’3-5å€‹ã®å°ã•ãªã‚¿ã‚¹ã‚¯ã«ç´°åˆ†åŒ–ã—ã¦ãã ã•ã„ã€‚
        å„ã‚¿ã‚¹ã‚¯ã¯å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚
        
        ã‚¿ã‚¹ã‚¯: \(taskTitle)
        
        å‡ºåŠ›å½¢å¼: JSONé…åˆ—ï¼ˆå„è¦ç´ ã¯ã‚¿ã‚¹ã‚¯åã®æ–‡å­—åˆ—ï¼‰
        """
        
        let body: [String: Any] = [
            "model": "gpt-3.5-turbo",
            "messages": [
                ["role": "user", "content": prompt]
            ],
            "temperature": 0.7,
            "max_tokens": 500
        ]
        
        request.httpBody = try JSONSerialization.data(withJSONObject: body)
        
        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ10ç§’ï¼‰
        let (data, response) = try await session.data(for: request)
        
        guard let httpResponse = response as? HTTPURLResponse,
              httpResponse.statusCode == 200 else {
            throw APIError.invalidResponse
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹
        let decoder = JSONDecoder()
        let apiResponse = try decoder.decode(OpenAIResponse.self, from: data)
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’æŠ½å‡º
        guard let content = apiResponse.choices.first?.message.content else {
            throw APIError.invalidResponse
        }
        
        // JSONé…åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹
        let subtasks = try parseSubtaskList(from: content)
        
        return SubdivisionResponse(subtasks: subtasks)
    }
    
    private func parseSubtaskList(from content: String) throws -> [String] {
        // JSONé…åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹å®Ÿè£…
        // ä¾‹: ["ã‚¿ã‚¹ã‚¯1", "ã‚¿ã‚¹ã‚¯2", "ã‚¿ã‚¹ã‚¯3"]
        let jsonData = content.data(using: .utf8)!
        return try JSONDecoder().decode([String].self, from: jsonData)
    }
}
```

### 5.5 è‡ªç„¶è¨€èªè§£æãƒ­ã‚¸ãƒƒã‚¯

#### 5.5.1 NaturalLanguageParser

```swift
class NaturalLanguageParser {
    private let detector: NSDataDetector
    
    init() {
        detector = try! NSDataDetector(types: NSTextCheckingResult.CheckingType.date.rawValue)
    }
    
    struct ExtractionResult {
        let dateTime: Date?
        let taskType: TaskType?
    }
    
    // è‡ªç„¶è¨€èªã‹ã‚‰æ—¥æ™‚ã‚’æŠ½å‡º
    func extractDateTime(from text: String) -> ExtractionResult {
        let range = NSRange(text.startIndex..., in: text)
        let matches = detector.matches(in: text, options: [], range: range)
        
        guard let match = matches.first,
              let date = match.date else {
            return ExtractionResult(dateTime: nil, taskType: nil)
        }
        
        // ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã®åˆ¤å®š
        let taskType: TaskType
        if text.contains("ã¾ã§") || text.contains("æœŸé™") || text.contains("ç· åˆ‡") {
            taskType = .task
        } else if text.contains("ã«") || text.contains("æ™‚") || text.contains("é–‹å§‹") {
            taskType = .schedule
        } else {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚¿ã‚¹ã‚¯
            taskType = .task
        }
        
        return ExtractionResult(dateTime: date, taskType: taskType)
    }
}
```

### 5.6 ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

#### 5.6.1 RepeatingTaskGenerator

```swift
class RepeatingTaskGenerator {
    private let taskManager: TaskManager
    
    // æ¬¡å›ã®ç¹°ã‚Šè¿”ã—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ
    func generateNextInstance(for task: Task) async throws {
        guard let pattern = task.repeatPattern else { return }
        
        let nextDate = calculateNextDate(
            from: task.deadline ?? task.startDateTime ?? Date(),
            pattern: pattern
        )
        
        // ç¹°ã‚Šè¿”ã—çµ‚äº†æ—¥æ™‚ã®ãƒã‚§ãƒƒã‚¯
        if let endDate = task.repeatEndDate, nextDate > endDate {
            return // ç¹°ã‚Šè¿”ã—çµ‚äº†
        }
        
        // æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        let nextTask = Task(
            title: task.title,
            category: task.category,
            priority: task.priority,
            taskType: task.taskType,
            deadline: task.taskType == .task ? nextDate : nil,
            startDateTime: task.taskType == .schedule ? nextDate : nil,
            alarmEnabled: task.alarmEnabled,
            alarmDateTime: task.alarmDateTime.map { addInterval(to: $0, pattern: pattern) },
            reminderEnabled: task.reminderEnabled,
            reminderInterval: task.reminderInterval,
            isRepeating: true,
            repeatPattern: pattern,
            repeatEndDate: task.repeatEndDate,
            parentTaskId: task.id
        )
        
        try await taskManager.createTask(nextTask)
    }
    
    // æ¬¡å›æ—¥æ™‚ã®è¨ˆç®—
    private func calculateNextDate(from date: Date, pattern: RepeatPattern) -> Date {
        let calendar = Calendar.current
        
        switch pattern {
        case .daily:
            return calendar.date(byAdding: .day, value: 1, to: date)!
            
        case .weekly:
            return calendar.date(byAdding: .weekOfYear, value: 1, to: date)!
            
        case .monthly:
            return calendar.date(byAdding: .month, value: 1, to: date)!
            
        case .yearly:
            return calendar.date(byAdding: .year, value: 1, to: date)!
            
        case .everyNDays(let n):
            return calendar.date(byAdding: .day, value: n, to: date)!
            
        case .nthWeekdayOfMonth(let weekday, let week):
            // æ¯æœˆç¬¬Næ›œæ—¥ã®è¨ˆç®—
            return calculateNthWeekday(weekday: weekday, week: week, from: date)
            
        case .custom:
            // ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡¦ç†
            return date
        }
    }
}
```

---

## 6. APIè¨­è¨ˆ

### 6.1 LLM APIä»•æ§˜

#### 6.1.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **URL**: `https://api.openai.com/v1/chat/completions`ï¼ˆä¾‹ï¼‰
- **ãƒ¡ã‚½ãƒƒãƒ‰**: POST
- **èªè¨¼**: Bearer Token

#### 6.1.2 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```json
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "user",
      "content": "ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’3-5å€‹ã®å°ã•ãªã‚¿ã‚¹ã‚¯ã«ç´°åˆ†åŒ–ã—ã¦ãã ã•ã„ã€‚\nå„ã‚¿ã‚¹ã‚¯ã¯å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚\n\nã‚¿ã‚¹ã‚¯: éƒ¨å±‹ã®æƒé™¤\n\nå‡ºåŠ›å½¢å¼: JSONé…åˆ—ï¼ˆå„è¦ç´ ã¯ã‚¿ã‚¹ã‚¯åã®æ–‡å­—åˆ—ï¼‰"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 500
}
```

#### 6.1.3 ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "created": 1234567890,
  "model": "gpt-3.5-turbo",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "[\"åºŠã‚’æƒé™¤æ©Ÿã§ã‹ã‘ã‚‹\", \"çª“ã‚’æ‹­ã\", \"ã‚´ãƒŸã‚’æ¨ã¦ã‚‹\", \"æœºã‚’æ•´ç†ã™ã‚‹\"]"
      },
      "finish_reason": "stop"
    }
  ]
}
```

#### 6.1.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ10ç§’ã€ãƒªãƒˆãƒ©ã‚¤3å›ã¾ã§
- **APIã‚¨ãƒ©ãƒ¼**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç´°åˆ†åŒ–æ¡ˆã‚’æç¤º

---

## 7. é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### 7.1 é€šçŸ¥ã‚«ãƒ†ã‚´ãƒªå®šç¾©

```swift
extension UNNotificationCategory {
    static let alarm = UNNotificationCategory(
        identifier: "ALARM",
        actions: [
            UNNotificationAction(
                identifier: "SNOOZE",
                title: "ã‚¹ãƒŒãƒ¼ã‚º",
                options: []
            ),
            UNNotificationAction(
                identifier: "COMPLETE",
                title: "å®Œäº†",
                options: [.foreground]
            ),
            UNNotificationAction(
                identifier: "OPEN",
                title: "ã‚¢ãƒ—ãƒªã‚’é–‹ã",
                options: [.foreground]
            )
        ],
        intentIdentifiers: [],
        options: []
    )
    
    static let reminder = UNNotificationCategory(
        identifier: "REMINDER",
        actions: [
            UNNotificationAction(
                identifier: "SNOOZE",
                title: "ã‚¹ãƒŒãƒ¼ã‚º",
                options: []
            ),
            UNNotificationAction(
                identifier: "COMPLETE",
                title: "å®Œäº†",
                options: [.foreground]
            ),
            UNNotificationAction(
                identifier: "STOP",
                title: "åœæ­¢",
                options: []
            ),
            UNNotificationAction(
                identifier: "OPEN",
                title: "ã‚¢ãƒ—ãƒªã‚’é–‹ã",
                options: [.foreground]
            )
        ],
        intentIdentifiers: [],
        options: []
    )
}
```

### 7.2 é€šçŸ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†

```swift
class NotificationActionHandler: NSObject, UNUserNotificationCenterDelegate {
    private let taskManager: TaskManager
    private let notificationManager: NotificationManager
    
    func userNotificationCenter(
        _ center: UNUserNotificationCenter,
        didReceive response: UNNotificationResponse,
        withCompletionHandler completionHandler: @escaping () -> Void
    ) {
        let taskId = extractTaskId(from: response.notification)
        guard let task = taskManager.fetchTask(id: taskId) else {
            completionHandler()
            return
        }
        
        switch response.actionIdentifier {
        case "SNOOZE":
            Task {
                try? await notificationManager.snoozeReminder(for: task)
            }
            
        case "COMPLETE":
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºï¼ˆUIå±¤ã§å‡¦ç†ï¼‰
            showCompletionConfirmation(for: task)
            
        case "STOP":
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºï¼ˆUIå±¤ã§å‡¦ç†ï¼‰
            showStopConfirmation(for: task)
            
        case "OPEN":
            // ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã‚¿ã‚¹ã‚¯è©³ç´°ç”»é¢ã‚’è¡¨ç¤º
            openTaskDetail(task)
            
        default:
            break
        }
        
        completionHandler()
    }
}
```

---

## 8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 8.1 ã‚¨ãƒ©ãƒ¼å®šç¾©

```swift
enum TaskError: LocalizedError {
    case invalidTitle
    case invalidDateTime
    case taskNotFound
    case saveFailed
    
    var errorDescription: String? {
        switch self {
        case .invalidTitle:
            return "ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
        case .invalidDateTime:
            return "æ—¥æ™‚è¨­å®šãŒç„¡åŠ¹ã§ã™"
        case .taskNotFound:
            return "ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        case .saveFailed:
            return "ã‚¿ã‚¹ã‚¯ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ"
        }
    }
}

enum NotificationError: LocalizedError {
    case authorizationDenied
    case schedulingFailed
    case maxSnoozeReached
    
    var errorDescription: String? {
        switch self {
        case .authorizationDenied:
            return "é€šçŸ¥ã®è¨±å¯ãŒå¿…è¦ã§ã™"
        case .schedulingFailed:
            return "é€šçŸ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ"
        case .maxSnoozeReached:
            return "ã‚¹ãƒŒãƒ¼ã‚ºã®æœ€å¤§å›æ•°ã«é”ã—ã¾ã—ãŸ"
        }
    }
}

enum APIError: LocalizedError {
    case networkError
    case invalidResponse
    case timeout
    
    var errorDescription: String? {
        switch self {
        case .networkError:
            return "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
        case .invalidResponse:
            return "ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒç„¡åŠ¹ã§ã™"
        case .timeout:
            return "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸ"
        }
    }
}
```

### 8.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º**
2. **ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ãªæ“ä½œã¯è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤**
3. **è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã¯ãƒ­ã‚°ã«è¨˜éŒ²**
4. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œã‚’å¯èƒ½ã«ã™ã‚‹**

---

## 9. ãƒ†ã‚¹ãƒˆä»•æ§˜

### 9.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

#### 9.1.1 TaskManagerãƒ†ã‚¹ãƒˆ
- ã‚¿ã‚¹ã‚¯ä½œæˆã®æˆåŠŸã‚±ãƒ¼ã‚¹
- ã‚¿ã‚¹ã‚¯ä½œæˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- ã‚¿ã‚¹ã‚¯å®Œäº†ã®æˆåŠŸã‚±ãƒ¼ã‚¹
- ã‚¿ã‚¹ã‚¯å‰Šé™¤ã®æˆåŠŸã‚±ãƒ¼ã‚¹

#### 9.1.2 ReminderServiceãƒ†ã‚¹ãƒˆ
- ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ã®è¨ˆç®—ï¼ˆå„é‡è¦åº¦ãƒ»ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ï¼‰
- æ®µéšçš„ãƒªãƒã‚¤ãƒ³ãƒ‰é–“éš”ã®è¨ˆç®—
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é–‹å§‹æ—¥æ™‚å‰ã‹ã‚‰ã®ãƒªãƒã‚¤ãƒ³ãƒ‰

#### 9.1.3 NaturalLanguageParserãƒ†ã‚¹ãƒˆ
- æ—¥æ™‚æŠ½å‡ºã®æˆåŠŸã‚±ãƒ¼ã‚¹
- ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã®åˆ¤å®š
- æ—¥æ™‚æŠ½å‡ºã®å¤±æ•—ã‚±ãƒ¼ã‚¹

### 9.2 çµ±åˆãƒ†ã‚¹ãƒˆ

#### 9.2.1 ã‚¿ã‚¹ã‚¯ç™»éŒ²ãƒ•ãƒ­ãƒ¼
1. ã‚¿ã‚¹ã‚¯ç™»éŒ²ç”»é¢ã§ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›
2. ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
3. ã‚¿ã‚¹ã‚¯ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. é€šçŸ¥ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### 9.2.2 ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ãƒ•ãƒ­ãƒ¼
1. ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šæ¸ˆã¿ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
2. é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ã‚¹ãƒŒãƒ¼ã‚ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
4. æ¬¡ã®ãƒªãƒã‚¤ãƒ³ãƒ‰ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### 9.3 UIãƒ†ã‚¹ãƒˆ

#### 9.3.1 ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢
- ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤º
- ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
- ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
- ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

#### 9.3.2 ã‚¿ã‚¹ã‚¯ç™»éŒ²ç”»é¢
- å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹•ä½œ
- è‡ªç„¶è¨€èªè§£æã®å‹•ä½œ
- ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“ã®é¸æŠ
- ä¿å­˜å‡¦ç†

---

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 10.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®šï¼ˆid, createdAt, deadline, startDateTimeï¼‰
- ãƒãƒƒãƒå‡¦ç†ã®å®Ÿè£…
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰

### 10.2 é€šçŸ¥æœ€é©åŒ–
- é€šçŸ¥ã®ä¸€æ‹¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- ä¸è¦ãªé€šçŸ¥ã®å‰Šé™¤
- é€šçŸ¥IDã®åŠ¹ç‡çš„ãªç®¡ç†

### 10.3 UIæœ€é©åŒ–
- ãƒªã‚¹ãƒˆã®é…å»¶èª­ã¿è¾¼ã¿
- ç”»åƒãƒ»ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€é©åŒ–

---

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

### 11.1 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ï¼ˆCore Data/SwiftDataï¼‰
- APIã‚­ãƒ¼ã®å®‰å…¨ãªä¿å­˜ï¼ˆKeychainï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç«¯æœ«å†…ä¿å­˜

### 11.2 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
- LLM APIå‘¼ã³å‡ºã—æ™‚ã®æ˜ç¤ºçš„ãªé€šçŸ¥
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®æä¾›
- ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®æœ€å°åŒ–ï¼ˆã‚¿ã‚¹ã‚¯åã®ã¿ï¼‰

---

## 12. å®Ÿè£…è¨ˆç”»

### 12.1 Phase 1: åŸºæœ¬æ©Ÿèƒ½
1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®Ÿè£…
2. ã‚¿ã‚¹ã‚¯CRUDæ©Ÿèƒ½
3. é€šçŸ¥æ©Ÿèƒ½ï¼ˆã‚¢ãƒ©ãƒ¼ãƒ ãƒ»ãƒªãƒã‚¤ãƒ³ãƒ‰ï¼‰
4. åŸºæœ¬UIå®Ÿè£…

### 12.2 Phase 2: é«˜åº¦ãªæ©Ÿèƒ½
1. ã‚«ãƒ†ã‚´ãƒªæ©Ÿèƒ½
2. é‡è¦åº¦æ©Ÿèƒ½
3. ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯æ©Ÿèƒ½
4. è‡ªç„¶è¨€èªè§£ææ©Ÿèƒ½

### 12.3 Phase 3: æ‹¡å¼µæ©Ÿèƒ½
1. ã‚¿ã‚¹ã‚¯ç´°åˆ†åŒ–æ©Ÿèƒ½
2. ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“æ©Ÿèƒ½
3. é€šçŸ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
4. ç´°ã‹ã„UIèª¿æ•´

---

## 13. ä»˜éŒ²

### 13.1 ç”¨èªé›†
- **MVVM**: Model-View-ViewModelã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³
- **Core Data**: Appleã®ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **SwiftData**: iOS 17ä»¥é™ã®æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **UserNotifications**: iOSã®é€šçŸ¥ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **UNNotificationInterruptionLevel**: é€šçŸ¥ã®é‡è¦åº¦ãƒ¬ãƒ™ãƒ«

### 13.2 å‚è€ƒè³‡æ–™
- Apple Developer Documentation
- SwiftUI Documentation
- Core Data Programming Guide
- UserNotifications Framework Documentation

---

## 14. å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | å¤‰æ›´è€… |
|------|-----------|---------|--------|
| 2025-11-09 02:23 | 1.0 | åˆç‰ˆä½œæˆ | - |

